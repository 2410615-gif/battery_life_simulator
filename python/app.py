import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

# ----------------------------
# ê¸°ë³¸ ì„¤ì •
# ----------------------------
st.set_page_config(page_title="ğŸ”‹ ë°°í„°ë¦¬ ìˆ˜ëª… ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°", layout="centered")

st.title("ğŸ”‹ ë°°í„°ë¦¬ ìˆ˜ëª… ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°")
st.markdown("""
ì´ ì‹œë®¬ë ˆì´í„°ëŠ” ë°°í„°ë¦¬ì˜ **ì¢…ë¥˜**, **ì‚¬ìš© ì¡°ê±´**, **ì˜¨ë„**, **ë°©ì „ ê¹Šì´(DoD)** ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ  
ì˜ˆìƒ ìˆ˜ëª…ê³¼ ìš©ëŸ‰ ì €í•˜ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
""")

# ----------------------------
# ì‚¬ìš©ì ì…ë ¥
# ----------------------------
battery_type = st.selectbox(
    "ë°°í„°ë¦¬ ì¢…ë¥˜ ì„ íƒ",
    ["ë¦¬íŠ¬ì´ì˜¨ (Li-ion)", "ë¦¬íŠ¬í´ë¦¬ë¨¸ (Li-Po)", "ë‹ˆì¼ˆìˆ˜ì†Œ (NiMH)", "ë‚©ì¶•ì „ì§€ (Pb-Acid)"]
)

temperature = st.slider("ì‚¬ìš© ì˜¨ë„ (Â°C)", -10, 60, 25)
depth_of_discharge = st.slider("ë°©ì „ ê¹Šì´ (DoD, %)", 10, 100, 80)
charge_rate = st.slider("ì¶©ì „ ì†ë„ (C-rate)", 0.2, 2.0, 1.0, 0.1)

st.markdown("---")

# ----------------------------
# ê°„ë‹¨í•œ ê²½í—˜ì  ëª¨ë¸
# ----------------------------

# ê¸°ë³¸ ìˆ˜ëª… (ì‚¬ì´í´ ìˆ˜)
base_life = {
    "ë¦¬íŠ¬ì´ì˜¨ (Li-ion)": 1500,
    "ë¦¬íŠ¬í´ë¦¬ë¨¸ (Li-Po)": 1200,
    "ë‹ˆì¼ˆìˆ˜ì†Œ (NiMH)": 800,
    "ë‚©ì¶•ì „ì§€ (Pb-Acid)": 500
}[battery_type]

# ì˜¨ë„ ë³´ì • (25Â°C ê¸°ì¤€, Arrhenius ê·¼ì‚¬)
temp_factor = np.exp(-0.05 * (temperature - 25))

# ë°©ì „ ê¹Šì´ ë³´ì • (DoDê°€ ê¹Šì„ìˆ˜ë¡ ìˆ˜ëª… ì§§ìŒ)
dod_factor = (100 / depth_of_discharge) ** 1.3

# ì¶©ì „ ì†ë„ ë³´ì • (C-rateê°€ ë†’ì„ìˆ˜ë¡ ìˆ˜ëª… ê°ì†Œ)
charge_factor = 1 / (1 + 0.3 * (charge_rate - 1))

# ì˜ˆì¸¡ ìˆ˜ëª… ê³„ì‚°
predicted_cycles = base_life * temp_factor * dod_factor * charge_factor
predicted_cycles = int(predicted_cycles)

# ----------------------------
# ê²°ê³¼ ì¶œë ¥
# ----------------------------
st.subheader("ğŸ“Š ì˜ˆì¸¡ ê²°ê³¼")
st.write(f"**ì˜ˆìƒ ë°°í„°ë¦¬ ìˆ˜ëª…:** ì•½ `{predicted_cycles:,}` ì‚¬ì´í´")

# ----------------------------
# ìš©ëŸ‰ ì €í•˜ ì‹œê°í™”
# ----------------------------
cycles = np.arange(0, predicted_cycles + 1)
capacity = 100 * np.exp(-cycles / (predicted_cycles / 5))

fig, ax = plt.subplots(figsize=(6, 4))
ax.plot(cycles, capacity, color='tab:blue')
ax.set_xlabel("ì‚¬ì´í´ ìˆ˜")
ax.set_ylabel("ìš©ëŸ‰ ìœ ì§€ìœ¨ (%)")
ax.set_title("ë°°í„°ë¦¬ ìš©ëŸ‰ ì €í•˜ ì˜ˆì¸¡ ê³¡ì„ ")
ax.grid(True, linestyle='--', alpha=0.6)
st.pyplot(fig)

# ----------------------------
# ìš”ì•½
# ----------------------------
st.markdown("""
### ğŸ’¡ í•´ì„
- **ì˜¨ë„ ìƒìŠ¹**, **ê¹Šì€ ë°©ì „**, **ë¹ ë¥¸ ì¶©ì „**ì€ ëª¨ë‘ ìˆ˜ëª… ë‹¨ì¶• ìš”ì¸ì…ë‹ˆë‹¤.  
- ì´ ëª¨ë¸ì€ ì‹¤ì œ ì‹¤í—˜ ë°ì´í„°ë¥¼ ë‹¨ìˆœí™”í•œ ì‹œë®¬ë ˆì´ì…˜ìœ¼ë¡œ,  
  **ì „ê¸°í™”í•™ì  ì—´í™” ë©”ì»¤ë‹ˆì¦˜ì„ ì´í•´**í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
""")
